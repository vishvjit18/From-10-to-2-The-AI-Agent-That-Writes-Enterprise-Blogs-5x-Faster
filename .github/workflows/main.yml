name: Sync Repo B → Repo A

on:
  workflow_dispatch:
  schedule:
    - cron: "0 */6 * * *"

jobs:
  sync:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout Repo A
        uses: actions/checkout@v4
        with:
          path: repoA
          token: ${{ secrets.SYNC_TOKEN }}

      - name: Checkout Repo B
        uses: actions/checkout@v4
        with:
          repository: vishvjit18/From-10-to-2-The-AI-Agent-That-Writes-Enterprise-Blogs-5x-Faster
          token: ${{ secrets.SYNC_TOKEN }}
          path: repoB

      - name: Sync Repo B → Repo A (no nested folders)
        run: |
          rsync -av --delete \
            --exclude '.git/' \
            --exclude '.github/' \
            repoB/ repoA/

      - name: Setup Git for Repo A
        run: |
          cd repoA
          git config user.name "GitHub Action"
          git config user.email "action@github.com"

      - name: Commit changes
        run: |
          cd repoA
          git checkout -B sync-from-repo-b || git checkout sync-from-repo-b
          git add .
          if git diff --staged --quiet; then
            echo "No changes to commit"
          else
            git commit -m "Sync from Repo B → Repo A [$(date +'%Y-%m-%d %H:%M:%S')]"
          fi

      - name: Push to Repo A branch
        run: |
          cd repoA
          git push https://${{ secrets.SYNC_TOKEN }}@github.com/parthShah2211ps/Content-Generation.git \
            sync-from-repo-b:sync-from-repo-b --force

